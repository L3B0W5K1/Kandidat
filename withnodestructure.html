<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Map with Nodes</title>
    <style>
        svg {
            border: 1px solid black;
        }
        .node {
            fill: blue;
        }
        .player {
            fill: red;
        }
        .index-label {
            font-family: Arial, sans-serif;
            font-size: 12px;
            fill: white;
            text-anchor: middle;
            dominant-baseline: central;
        }
        line.connection {
            stroke: black;
            stroke-width: 2;
        }
    </style>
</head>
<body>
    <svg id="map" width="1000" height="1000"></svg>

    <script>
        // Define the map with nodes and connections
        const mapData = {
            backgroundImage: "karta1.jpeg",
            nodes: [
                { id: 1, x: 200, y: 200, index: "1", neighbors: [2, 4, 3] }, 
                { id: 2, x: 300, y: 200, index: "2", neighbors: [1, 3] },
                { id: 3, x: 300, y: 100, index: "3", neighbors: [2, 1] }, 
                { id: 4, x: 100, y: 200, index: "4", neighbors: [1] }
            ],
            connections: [
                { from: 1, to: 2 },
                { from: 2, to: 3 },
                { from: 3, to: 1 }, 
                { from: 1, to: 4 }
            ],
            player: { id: "player", x: 100, y: 100, index: "P", neighbors: [1] } 
        };
      
        // Render the map
        const svg = document.getElementById("map");
      
        // Add background image
        const backgroundImage = document.createElementNS("http://www.w3.org/2000/svg", "image");
        backgroundImage.setAttribute("href", mapData.backgroundImage);
        backgroundImage.setAttribute("width", "1000");
        backgroundImage.setAttribute("height", "1000");
        svg.appendChild(backgroundImage);
      
        // Add nodes
        const nodes = new Map(); // Map to store nodes for easy access
        mapData.nodes.forEach((nodeData) => {
            const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            circle.setAttribute("class", "node");
            circle.setAttribute("cx", nodeData.x);
            circle.setAttribute("cy", nodeData.y);
            circle.setAttribute("r", "10");
            svg.appendChild(circle);
            nodes.set(nodeData.id, circle);
      
            // Add index label
            const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
            label.setAttribute("class", "index-label");
            label.setAttribute("x", nodeData.x);
            label.setAttribute("y", nodeData.y);
            label.textContent = nodeData.index;
            svg.appendChild(label);
        });
      
        // Add player
        const playerCircle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        playerCircle.setAttribute("class", "player");
        playerCircle.setAttribute("cx", mapData.player.x);
        playerCircle.setAttribute("cy", mapData.player.y);
        playerCircle.setAttribute("r", "10");
        svg.appendChild(playerCircle);
        nodes.set(mapData.player.id, playerCircle);
      
        // Add index label for player
        const playerLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        playerLabel.setAttribute("class", "index-label");
        playerLabel.setAttribute("x", mapData.player.x);
        playerLabel.setAttribute("y", mapData.player.y);
        playerLabel.textContent = mapData.player.index;
        svg.appendChild(playerLabel);
      
        // Add connections
        mapData.connections.forEach((connection) => {
            const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
            line.setAttribute("class", "connection");
            line.setAttribute("x1", mapData.nodes.find((node) => node.id === connection.from).x);
            line.setAttribute("y1", mapData.nodes.find((node) => node.id === connection.from).y);
            line.setAttribute("x2", mapData.nodes.find((node) => node.id === connection.to).x);
            line.setAttribute("y2", mapData.nodes.find((node) => node.id === connection.to).y);
            svg.appendChild(line);
        });
      
        // Function to update player position and neighbors
        function updatePlayerPosition(newNodeId) {
            const newNode = mapData.nodes.find((node) => node.id === newNodeId);
            // Update SVG display
            nodes.get("player").setAttribute("cx", newNode.x);
            nodes.get("player").setAttribute("cy", newNode.y);
      
            // Update player data
            mapData.player.x = newNode.x;
            mapData.player.y = newNode.y;
            mapData.player.neighbors = newNode.neighbors;
        }
      

        // Event listener for keyboard inputs
        document.addEventListener("keydown", (event) => {
            const key = event.key.toUpperCase(); // Convert to uppercase for consistency
            const targetNode = mapData.nodes.find((node) => node.index === key);

            if (targetNode && mapData.player.neighbors.includes(targetNode.id)) {
                // Check if the target node exists and is a neighbor
                updatePlayerPosition(targetNode.id);
            }
        });
    </script>
</body>
</html>
